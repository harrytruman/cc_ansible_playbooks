---
- name: create git repo
  git:
    repo: https://{{ gitusername | urlencode }}:{{ gitpassword }}@dev.url.com/git/etc/changeme
    dest: /var/tmp/repos/
    update: yes
    version: master

- name: create {{ device_os }} configration file
  template:
    src: templates/{{ device_os }}.j2
    dest: /var/tmp/tower-config-repo/configs/{{ device_os }}-{{ ansible_date_time.date }}-{{ ansible_date_time.time }}.conf

- name: add template to git
  command: "git add --all"
  args:
    chdir: /var/tmp/repos/
  register: gitadd

- name: commit to git
  command: git commit -a -m "added config for {{ device_os }}-{{ ansible_date_time.date }}-{{ ansible_date_time.time }}"
  args:
    chdir: /var/tmp/repos/
  register: gitcommit

- name: push to git
  command: git push
  args:
    chdir: /var/tmp/repos/
  register: gitpush
